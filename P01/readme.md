## توضیح خط‌به‌خط و Flow کد P01 (محاسبات آماری در Go)

این پروژه یک کتابخانه‌ی محاسبات آماری ساده در Go است که شامل توابع محاسبه‌ی میانگین، میانه، واریانس، انحراف معیار و مجموع برای آرایه‌ای از اعداد اعشاری است. کد شامل مدیریت خطا، تست‌های جامع، و الگوهای برنامه‌نویسی خوب در Go است.

### خروجی نهایی چه کاری انجام می‌دهد؟
- محاسبه‌ی میانگین آرایه‌ای از اعداد `[1, 2, 3, 4, 5]`
- چاپ نتیجه: `Mean: 3`
- نمایش استفاده از کتابخانه‌ی آماری

---

### Flow کلی برنامه
- تعریف توابع آماری در `calc.go`
- مدیریت خطا در `errors.go` و `validate.go`
- تست‌های جامع در `calc_test.go`
- اجرای نمونه در `main.go`

---

### توضیح خط‌به‌خط (با اشاره به شماره خطوط)

#### P01/main.go (L1–L12): نقطه ورود برنامه
- L1: `package main` - تعریف پکیج اصلی.
- L3–L5: Import کتابخانه‌ی `fmt` برای چاپ.
- L7: `func main()` - تابع اصلی برنامه.
- L8: `nums := []float64{1, 2, 3, 4, 5}`
  - تعریف آرایه‌ای از 5 عدد اعشاری برای تست.
- L9: `mean, _ := Mean(nums)`
  - فراخوانی تابع `Mean` و نادیده گرفتن خطا (در این مثال).
- L10: `fmt.Println("Mean:", mean) // 3`
  - چاپ نتیجه با کامنت انتظار.

#### P01/errors.go (L1–L6): تعریف خطاهای سفارشی
- L1: `package main` - تعریف پکیج اصلی.
- L3: Import کتابخانه‌ی `errors` استاندارد Go.
- L5: `var ErrEmptySlice = errors.New("input slice is empty")`
  - تعریف خطای سفارشی برای آرایه‌های خالی.
  - این خطا در تمام توابع آماری استفاده می‌شود.

#### P01/validate.go (L1–L9): تابع اعتبارسنجی
- L1: `package main` - تعریف پکیج اصلی.
- L3: `func requireNonEmpty(xs []float64) error`
  - تابع کمکی برای بررسی خالی نبودن آرایه.
- L4–L7: بررسی طول آرایه
  - L4: `if len(xs) == 0`
  - L5: `return ErrEmptySlice` - بازگشت خطای سفارشی.
  - L6: `return nil` - اگر آرایه خالی نباشد.
- این تابع در ابتدای همه‌ی توابع آماری فراخوانی می‌شود.

#### P01/calc.go (L1–L60): توابع محاسبات آماری

##### L1–L5: Imports
- L1: `package main` - تعریف پکیج اصلی.
- L3–L6: Import کتابخانه‌های مورد نیاز:
  - `math`: برای تابع `Sqrt`.
  - `sort`: برای مرتب‌سازی آرایه در محاسبه‌ی میانه.

##### L8–L16: تابع `Sum` - محاسبه‌ی مجموع
- L8: `func Sum(xs []float64) (float64, error)`
  - تابع محاسبه‌ی مجموع با بازگشت مقدار و خطا.
- L9–L11: اعتبارسنجی ورودی
  - L9: `if err := requireNonEmpty(xs); err != nil`
  - L10: `return 0, err` - بازگشت خطا در صورت آرایه‌ی خالی.
- L12: `var s float64` - متغیر جمع‌کننده.
- L13–L15: حلقه‌ی جمع‌آوری
  - L13: `for _, v := range xs`
  - L14: `s += v` - اضافه کردن هر مقدار به جمع.
- L16: `return s, nil` - بازگشت مجموع و خطای صفر.

##### L18–L25: تابع `Mean` - محاسبه‌ی میانگین
- L18: `func Mean(xs []float64) (float64, error)`
  - تابع محاسبه‌ی میانگین حسابی.
- L19–L21: اعتبارسنجی ورودی (مشابه `Sum`).
- L22: `s, _ := Sum(xs)`
  - فراخوانی تابع `Sum` و نادیده گرفتن خطا (چون قبلاً اعتبارسنجی شده).
- L23: `return s / float64(len(xs)), nil`
  - تقسیم مجموع بر تعداد عناصر و بازگشت میانگین.

##### L27–L37: تابع `Median` - محاسبه‌ی میانه
- L27: `func Median(xs []float64) (float64, error)`
  - تابع محاسبه‌ی میانه (مقدار وسط).
- L28–L30: اعتبارسنجی ورودی.
- L31: `cp := append([]float64(nil), xs...)`
  - کپی کردن آرایه برای جلوگیری از تغییر آرایه‌ی اصلی.
- L32: `sort.Float64s(cp)`
  - مرتب‌سازی آرایه به صورت صعودی.
- L33: `n := len(cp)` - تعداد عناصر.
- L34–L37: محاسبه‌ی میانه
  - L34: `if n%2 == 1` - بررسی فرد بودن تعداد عناصر.
  - L35: `return cp[n/2], nil` - میانه برای آرایه‌های فرد.
  - L36: `return (cp[n/2-1] + cp[n/2]) / 2, nil` - میانه برای آرایه‌های زوج.

##### L39–L48: تابع `Variance` - محاسبه‌ی واریانس
- L39: `func Variance(xs []float64) (float64, error)`
  - تابع محاسبه‌ی واریانس (میانگین مجذور انحرافات).
- L40–L42: اعتبارسنجی ورودی.
- L43: `m, _ := Mean(xs)`
  - محاسبه‌ی میانگین برای استفاده در فرمول واریانس.
- L44: `var acc float64` - متغیر جمع‌کننده مجذور انحرافات.
- L45–L47: حلقه‌ی محاسبه‌ی انحرافات
  - L45: `for _, v := range xs`
  - L46: `d := v - m` - محاسبه‌ی انحراف از میانگین.
  - L47: `acc += d * d` - جمع مجذور انحرافات.
- L48: `return acc / float64(len(xs)), nil`
  - تقسیم بر تعداد عناصر و بازگشت واریانس.

##### L50–L56: تابع `Std` - محاسبه‌ی انحراف معیار
- L50: `func Std(xs []float64) (float64, error)`
  - تابع محاسبه‌ی انحراف معیار (جذر واریانس).
- L51–L54: محاسبه‌ی واریانس
  - L51: `v, err := Variance(xs)`
  - L52–L54: بررسی خطا و بازگشت در صورت وجود.
- L55: `return math.Sqrt(v), nil`
  - محاسبه‌ی جذر واریانس و بازگشت انحراف معیار.

#### P01/calc_test.go (L1–L50): تست‌های جامع

##### L1–L5: Imports
- L1: `package main` - تعریف پکیج اصلی.
- L3: Import کتابخانه‌ی `testing` استاندارد Go.

##### L5–L20: تست تابع `Sum`
- L5: `func TestSum(t *testing.T)`
  - تابع تست برای `Sum`.
- L6–L12: تعریف تست‌های مختلف
  - L6: `tests := []struct {` - آرایه‌ای از ساختارهای تست.
  - L7–L11: فیلدهای ساختار تست:
    - `name`: نام تست.
    - `in`: ورودی آرایه.
    - `want`: مقدار مورد انتظار.
    - `wantErr`: آیا خطا انتظار می‌رود.
- L12–L19: تست‌های مختلف:
  - `"normal"`: آرایه عادی `[1, 2, 3]` → `6`.
  - `"single"`: آرایه تک عنصری `[5]` → `5`.
  - `"empty"`: آرایه خالی `[]` → خطا.
- L13–L19: حلقه‌ی اجرای تست‌ها
  - L13: `for _, tt := range tests`
  - L14: `t.Run(tt.name, func(t *testing.T) {` - اجرای هر تست.
  - L15: `got, err := Sum(tt.in)` - فراخوانی تابع.
  - L16–L18: بررسی خطا
    - L16: `if (err != nil) != tt.wantErr`
    - L17: `t.Fatalf("err=%v, wantErr=%v", err, tt.wantErr)`
  - L18–L19: بررسی مقدار
    - L18: `if !tt.wantErr && got != tt.want`
    - L19: `t.Fatalf("got=%v, want=%v", got, tt.want)`

##### L22–L50: تست توابع `Mean`, `Median`, `Std`
- L23: `mean, _ := Mean([]float64{1, 2, 3, 4}) // 2.5`
  - تست میانگین آرایه‌ی `[1, 2, 3, 4]` → `2.5`.
- L24–L26: بررسی نتیجه میانگین.
- L28: `medOdd, _ := Median([]float64{9, 1, 5}) // 5`
  - تست میانه آرایه‌ی فرد `[9, 1, 5]` → `5`.
- L29–L31: بررسی نتیجه میانه فرد.
- L33: `medEven, _ := Median([]float64{1, 2, 3, 4}) // 2.5`
  - تست میانه آرایه‌ی زوج `[1, 2, 3, 4]` → `2.5`.
- L34–L36: بررسی نتیجه میانه زوج.
- L38: `std, _ := Std([]float64{2, 2, 2, 2}) // 0`
  - تست انحراف معیار آرایه‌ی یکسان `[2, 2, 2, 2]` → `0`.
- L39–L41: بررسی نتیجه انحراف معیار.

---

### چرا این الگوها؟ چرا این ساختار؟

#### مدیریت خطا (Error Handling)
- **خطاهای سفارشی**: `ErrEmptySlice` برای آرایه‌های خالی.
- **اعتبارسنجی اولیه**: همه‌ی توابع ابتدا آرایه را بررسی می‌کنند.
- **بازگشت خطا**: همه‌ی توابع `(result, error)` برمی‌گردانند.

#### طراحی توابع
- **تک مسئولیتی**: هر تابع یک کار مشخص انجام می‌دهد.
- **بازاستفاده‌پذیری**: `Mean` از `Sum` استفاده می‌کند.
- **عدم تغییر ورودی**: `Median` آرایه‌ی اصلی را تغییر نمی‌دهد.

#### تست‌نویسی
- **تست‌های جدول‌محور**: استفاده از `[]struct` برای تست‌های متعدد.
- **پوشش کامل**: تست حالت‌های عادی، مرزی و خطا.
- **خوانایی**: نام‌گذاری واضح تست‌ها.

### اجرای برنامه

#### اجرای اصلی:
```bash
go run P01/main.go
```
خروجی: `Mean: 3`

#### اجرای تست‌ها:
```bash
go test P01/
```

#### اجرای تست‌ها با جزئیات:
```bash
go test -v P01/
```

#### اجرای Benchmark:
```bash
go test -bench=. P01/
```

### مثال‌های استفاده

```go
// محاسبه‌ی میانگین
nums := []float64{1, 2, 3, 4, 5}
mean, err := Mean(nums)
if err != nil {
    log.Fatal(err)
}
fmt.Println("Mean:", mean) // Mean: 3

// محاسبه‌ی میانه
median, err := Median(nums)
fmt.Println("Median:", median) // Median: 3

// محاسبه‌ی انحراف معیار
std, err := Std(nums)
fmt.Println("Standard Deviation:", std) // Standard Deviation: 1.5811388300841898
```

### نکات مهم 

#### الگوهای Go
- **Error Handling**: استفاده از `(result, error)` pattern.
- **Package Structure**: جداسازی منطقی فایل‌ها.
- **Testing**: تست‌های جامع با `testing` package.

#### بهینه‌سازی
- **کپی آرایه**: در `Median` برای جلوگیری از تغییر آرایه‌ی اصلی.
- **محاسبات کارآمد**: استفاده مجدد از `Sum` در `Mean`.
- **مدیریت حافظه**: استفاده از `append` برای کپی آرایه.

#### قابلیت توسعه
- **اضافه کردن توابع جدید**: الگوی مشابه برای توابع آماری دیگر.
- **پشتیبانی از انواع دیگر**: می‌توان برای `int` یا `float32` گسترش داد.
- **تنظیمات پیشرفته**: اضافه کردن گزینه‌های محاسباتی.

---

### جمع‌بندی
این پروژه نمونه‌ای از طراحی خوب در Go است که شامل مدیریت خطا، تست‌نویسی جامع، و ساختار منطقی کد می‌شود. الگوهای استفاده شده قابل استفاده در پروژه‌های بزرگ‌تر و قابل گسترش هستند.
